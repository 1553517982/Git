#ifndef __ResourceHelpers_H__
#define __ResourceHelpers_H__

#include <string>
#include "cocos/studio_ext/XCSLoaderRet.h"
/*! \class  ResourceHelpers
*  \brief  资源管理器，主要面向脚本
*
*
*/
class XLambda;
class XAsyncLoadOption;

class ResourceHelpers
{
public:
	static void init();

	/** \example test_Downloader.lua
	*/
	/** \example test_XSlotAnimateSprite.lua
	*/

	static void fini();

	/*!
	* \brief 读取动画依赖
	* \param const char * szFilename
	* \return bool
	*/
	static bool loadDependency(const char* szFilename);

	/*!
	* \brief 清除Cache
	* \return void
	*/
	static void purgeCache();

	/*!
	* \brief 异步读取动画
	* \param XAsyncLoadOption* option
	* \return unsigned int 返回handler用来cancel
	\sa test_XSlotAnimateSprite.lua
	*/
	static  unsigned int loadAnimationAsync(XAsyncLoadOption* option);

	/*!
	* \brief 异步加载纹理
	* \param XAsyncLoadOption* option
	* \return unsigned int 返回handler用来cancel
	*/
	static  unsigned int loadTextureAsync(XAsyncLoadOption* option);

	/*!
	* \brief 下载
	* \param lua_State * L table 和三个Lua回调函输 
	* \return bool
	* \section download 参数
	参数1 = okFunction 成功下载函数<br/>
	参数2 = errorFunction 下载失败函数<br/>
	参数3 = progressFunction 下载/解压进度函数, </br>
	如果有多次调用监听同一个下载进度，只有第一次调用才会成功监听，<br/>
	其他的不会受到通知. 这个是因为Curl的参数在第一次调用时，下载监听已经被设置好了，后面无法改变，也没啥意义。<br/>
	{<br/>
	file = 下载的文件<br/>
	url  = 下载URL<br/>
	priority = 优先度(可选)<br/>
	retry = 重试(可选)<br/>
	md5 = 较验用的md5(可选)<br/>
	fileSize = 文件大小(可选)<br/>
	}<br/>
	\sa test_Downloader.lua
	*/
	static int loadWWW(ValueMap& pkMap, XLambda* okFunction, XLambda* errorFunction, XLambda* progressFunction);

	//static int download(ValueMap& pkMap, XLambda* okFunction, XLambda* errorFunction, XLambda* progressFunction);

	/*!
	* \brief 取消异步加载
	* \param unsigned int handle 之前创建的Handle
	* \return void
	*/
	static void cancelLoadAsync(unsigned int handle);

	/*!
	* \brief 创建一个异步加载的Option
	* \param const char * filename 文件名
	* \param const char * customID 用户定制ID
	* \param unsigned char priority 优先度
	* \param XLambda* handle 脚本回调
	* \return XAsyncLoadOption* 异步加载option
	*/
	static XAsyncLoadOption* getAsyncLoadOption(const char* filename,
												const char* customID,
												unsigned char priority,
												XLambda* handle);

	/*!
	* \brief 
	* \param const char * filename
	* \param const char * customID
	* \param unsigned char priority
	* \param XLambda* luaFunction
	* \return unsigned int
	*/
	static unsigned int loadCSBTextureAsync(XAsyncLoadOption* option);


	static XCSLoadRet* loadCSB(const char* filename, bool bWithTimeline, bool bCache);

	//XCSLoadRet* loadCSB(const char* filename, bool bWithTimeline, bool bCache, XLambda* luaFunction);

	static void purgeCSBCache();

	static void cancelAllAsyncLoadScript();

	static void cancelAllAsyncLoad();

	static int decompressAsync(const char* filename, unsigned int progressThreshold, XLambda* finish, XLambda* progress);

	static void listenAsyncFinish(XLambda* finish);
};

#endif /* defined(__CocoGUI__UISystem__) */
